import shodan
import sys
import os 
import pprint

def read_file(file_name):
    """Reads the content of a file and yields every line. 
    
    Arguments:
        file_name {str} -- The name of the File to read.
    """
    with open(file_name) as file_to_read:
        for line in file_to_read:
            yield line

def shodan_info():
    """
    Retrieves api key from shodan.key file and 
    reads IP from sys.argv and makes API call to get shodan information.
    Shodan 'ip' parameter is used to query shodan.
    """
    if len(sys.argv) < 2:
        print("[!] no IP supplied")
        sys.exit(1)
    ip = sys.argv[1]
    shodan_api_key = [line for line in read_file("shodan.key")][0]
    api = shodan.Shodan(shodan_api_key)
    pp = pprint.PrettyPrinter(indent=4)
    try:
        results = api.search(f"ip:{ip}")
        print('Results found: {}'.format(results['total']))
        pp.pprint(results)
    except shodan.APIError as e:
            print('Error: {}'.format(e))


if __name__ == "__main__":
    shodan_info()